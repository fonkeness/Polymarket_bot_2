# Руководство по тестированию API пагинации

Это руководство поможет диагностировать проблему остановки скрипта на ~906 трейдах.

## Подготовка

1. Подключитесь к серверу через SSH:
```bash
ssh ваш_сервер
```

2. Перейдите в директорию проекта:
```bash
cd ~/projects/Polymarket_bot_2
```

3. Активируйте виртуальное окружение:
```bash
source venv/bin/activate
```

4. Обновите код (если нужно):
```bash
git pull
```

## Тест 1: Проверка разных offset

**Цель:** Узнать, что возвращает API при разных значениях offset.

**Команда:**
```bash
python scripts/test_api_pagination.py
```

**Что смотреть:**
- Количество трейдов при каждом offset
- Диапазон дат трейдов
- На каком offset API начинает возвращать пустой массив

**Ожидаемый результат:**
- Offset 0-500: должны быть трейды
- Offset 1000+: проверить, есть ли данные или пусто

## Тест 2: Проверка на дубликаты данных

**Цель:** Проверить, не возвращает ли API одинаковые данные при разных offset.

**Команда:** (входит в общий скрипт выше)

**Что смотреть:**
- Сравнить первые трейды при offset=0 и offset=1000
- Если одинаковые - API зацикливается

## Тест 3: Проверка обработки ошибок

**Цель:** Узнать, возвращает ли API ошибки при больших offset.

**Команда:** (входит в общий скрипт выше)

**Что смотреть:**
- Есть ли HTTP ошибки (400, 500, etc.)
- На каком offset появляются ошибки

## Тест 4: Проверка общего количества доступных трейдов

**Цель:** Узнать, сколько всего уникальных трейдов доступно через API.

**Команда:** (входит в общий скрипт выше)

**Что смотреть:**
- Общее количество уникальных timestamp'ов
- Общее количество уникальных сигнатур
- Количество дубликатов
- На каком offset API перестает возвращать новые данные

## Тест 5: Детальная проверка диапазона 900-1500

**Цель:** Детально проверить диапазон, где скрипт останавливается.

**Команда:** (входит в общий скрипт выше)

**Что смотреть:**
- Что происходит при offset 900, 1000, 1100, 1200, 1300, 1400, 1500
- Есть ли резкое изменение в количестве трейдов
- Есть ли изменение в диапазоне дат

## Альтернативный тест: Ручная проверка через curl

Если Python скрипт не работает, можно проверить напрямую через curl:

```bash
# Проверить offset=0
curl -s "https://data-api.polymarket.com/trades?market=0x0576b194302d7d0a3f7bfc1b843cef4a5c9d582a3f424f879c15441feed78f01&limit=10&offset=0" | python -c "import sys,json; d=json.load(sys.stdin); print(f'Got {len(d)} trades')"

# Проверить offset=1000
curl -s "https://data-api.polymarket.com/trades?market=0x0576b194302d7d0a3f7bfc1b843cef4a5c9d582a3f424f879c15441feed78f01&limit=10&offset=1000" | python -c "import sys,json; d=json.load(sys.stdin); print(f'Got {len(d)} trades')"

# Проверить offset=5000
curl -s "https://data-api.polymarket.com/trades?market=0x0576b194302d7d0a3f7bfc1b843cef4a5c9d582a3f424f879c15441feed78f01&limit=10&offset=5000" | python -c "import sys,json; d=json.load(sys.stdin); print(f'Got {len(d)} trades')"
```

## Анализ результатов

После выполнения всех тестов, проверьте:

1. **Если API возвращает пустой массив после offset=1000:**
   - Проблема: API имеет ограничение на максимальный offset
   - Решение: Нужно использовать другой подход (timestamp-based pagination или другой endpoint)

2. **Если API возвращает те же данные при разных offset:**
   - Проблема: API зацикливается или не поддерживает offset правильно
   - Решение: Нужно использовать другой метод пагинации

3. **Если API возвращает ошибки при больших offset:**
   - Проблема: API имеет ограничение или баг
   - Решение: Обработать ошибки и использовать другой подход

4. **Если API возвращает данные, но скрипт останавливается:**
   - Проблема: Логика в коде останавливает загрузку неправильно
   - Решение: Исправить условия остановки в коде

## Следующие шаги

После анализа результатов тестов:
1. Сообщите результаты
2. Вместе определим причину проблемы
3. Исправим код или найдем альтернативный подход

